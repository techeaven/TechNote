---
title: Linux信号量基础
categories: D-Linux
permalink: linux-semaphore-basis
translate_title: linux-semaphore-base
date: 2015-11-02 23:28:21
tags:
description:
---
## 概述
什么是信号量？**信号量是软中断**  

一个健壮的程序需要处理信号量。因为信号量是一种传递异步事件到应用程序的方式。  

当用户按下ctrl+c的时候，一个进程发送一个信号量kill掉另一个进程。在这种情况下，通常一个进程需要处理信号量。  

## Linux信号量
在Linux中，每一个信号量都有一个以字符串**SIG**开头的名字，如：
* SIGINT,当用户按下ctrl+c的时候，会发出该信号。这是从终端终止程序的一种方式。
* SIGALRM,当alarm函数设置的定时器到时时，会产生该信号。
* SIGABRT,当进程调用abort函数时，会产生该信号。

当信号发生时，进程必须告诉内核如何处理该信号。有三种处理信号的方式：
* 信号可以被忽略。这意味着当信号发生时，内核什么事情都不会做。大多数的信号都可以被忽略，但是如果忽略由硬件异常产生的信号时，可能会导致怪异的后果。同样的，有些信号量如SIGKILL、SIGSTOP不能被忽略。
* 信号可以被捕获。当选择捕获信号时，进程会向内核注册一个函数。当信号产生时，内核会调用该函数。当被捕获的信号对于进程来说是非致命的，在注册函数中可以正确的处理该信号，否则，进程会选择平滑的终止。
* 使用默认行为。每一种信号都有对应的默认行为。

我们已经知道SIGKILL、SIGSTOP信号是不能被忽略的。这是因为这两种信号向root用户或内核提供了一种在任何情况下终止任何进程的方式。这些信号的默认行为是终止进程。这些信号的行为既不能被忽略也不能被忽略。

## 程序启动时发生了什么
程序启动时发生了什么取决于`exec`。当程序启动时，所有信号的状态都是被忽略或默认。通常信号的状态都是默认的，除非调用exec的进程选择忽略信号。  

由于我们通常会使程序在后台运行，因此shell会将quit信号设为忽略，因为我们不想进程被用户终止。  

## 为什么信号捕获函数需要被重入
我们已经知道对信号的一种处理方式是捕获信号。这种方式主要是在进程向内核注册一个函数，当信号发生时，该函数就会被调用。有一点需要记住的是：**进程注册的函数需要被重入**。  

在解释上面的原理之前，我们首先需要了解什么是重入函数(reentrant function)。重入函数是指函数的执行环境可以被保存，无论该函数被什么原因停止，然后还可以重新进入该函数的执行环境。  

## 总结
操作系统没学好，缺的知识点太多了，看英文文档大多数属于都理解不了，这篇文档先归档，以后再解决。

## 参考
* [Linux Signals Fundamentals – Part I](http://www.thegeekstuff.com/2012/03/linux-signals-fundamentals/)

<br />

